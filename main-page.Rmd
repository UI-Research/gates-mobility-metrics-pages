---
title: ''
author: ''
date: ''
font: Lato
output:
  html_document:
    self_contained: TRUE
    toc: TRUE
    toc_float: TRUE
    css: www/web_report.css
    output_dir: "."
    editor_options:
      chunk_output_type: console
params:
  state_county: !r c('51013', '06037', '53033', '36061')
---

<style>
@import url('https://fonts.googleapis.com/css?family=Lato&display=swap');
</style>

<link rel='stylesheet' href='//fonts.googleapis.com/css?family=Lato' />

```{r echo = FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(error = TRUE)
knitr::opts_chunk$set(results = 'asis')

```

```{r header-image, fig.width = 5.14, fig.height = 1.46, echo = FALSE}
# All defaults
knitr::include_graphics('www/images/urban-institute-logo.png')

```

```{r setup}

library(here)
library(data.table)
library(gt)
library(tidyverse)
library(glue)
library(rlang)
library(scales)
library(qdapRegex)

options(scipen = 999)

```


```{r set vars}

# set constant variables 

tb_title_size <- 18
tb_title_font <- 'bold'

tb_subtitle_size <- 14
tb_title_font <- 'normal'
tb_font_size <- 12 

source_note_size <- 11
source_note_font <- 'normal'

tb_width_perc <- 80
tb_align <- 'left'

decimal_points <- 2
income_decimal <- 0

income_varlist <- list(
  c(
    'pctl_20', 
    'pctl_50', 
    'pctl_80'
  ), 
  c(
    '20th Percentile', 
    '50th Percentile', 
    '80th Percentile'
  ), 
  c(
    'pctl_20', 
    'pctl_20_ci', 
    'pctl_50', 
    'pctl_50_ci', 
    'pctl_80',
    'pctl_80_ci'
  ), 
  c(
    '20th Percentile', 
    '20th Percentile ci', 
    '50th Percentile', 
    '50th Percentile ci', 
    '80th Percentile', 
    '80th Percentile ci'
  ) 
)

```


```{r read-in-data}

fpath <- 'data/mobility-metrics.csv'
data <- read_csv(fpath, )

metrics_summary <- 'metrics_summary.csv'
m_info <- fread(metrics_summary)

#checking missing 
#summary(data)
#sapply(data, function(x) sum(is.na(x)))


#create unique state-county identifier
data <- data %>% 
  mutate(state = str_pad(state, width = 2, side ='left', pad = '0'), 
         county = str_pad(county, width = 3, side ='left', pad = '0')) %>% 
  unite('state_county', county_name, state_name, sep = ', ', remove = FALSE) %>% 
  unite('full_fips', state, county, sep = '', remove = FALSE) %>% 
  filter(full_fips %in% (params$state_county)) %>% 
  arrange(factor(full_fips, levels = params$state_county)) %>% 
  mutate(state_county = gsub('County', '', state_county)) %>% 
  mutate(state_county = rm_white_comma(state_county))

#get the upward county - the first element in the parameter 
upward_county <- data %>% 
  filter(full_fips == params$state_county[1]) %>% 
  select(state_county) %>% 
  pull()



#convert to percentage 
perc_vars <- c(
  "share_debt_coll", # % with debt
  "homeless_share", # share homeless
  "famstruc_2par_married", # Two married biological/adoptive parents
  "famstruc_1par_noadults", # One biological/adoptive parent and that parent's current spouse/partner
  "famstruc_1par_plusadults", # One biological/adoptive parent and at least one other adult
  "famstruc_0par_2adults", # One biological/adoptive parent
  "famstruc_2par_unmarried", # Two adults, no parent
  "famstruc_0par_other", # Other
  "election_turnout", # % voting 
  "lbw", # % low birthweight
  "poverty_exposure", # % in high poverty
  "frpl40_total", # student poverty concentration
  "share_in_preschool", # % in pre k 
  "share_hs_degree" # % with HS degree
)

data <- data %>% 
  mutate_at(perc_vars, 
            function (x) scales::percent(x))


data <- data %>% 
  mutate_if(is.numeric, function(x) {format(round(x, 2), big.mark=",",scientific=FALSE)})


data <- data %>% 
  mutate(na_quality = 'NA')  #to be used for metrics where there is no quality variable


data <- data %>% 
  mutate_at(vars(ends_with('_quality')), 
            function(x) recode(x, `1` = 'Good', `2` = 'Marginal', `3` = 'Poor'))


data <- data %>% 
  rename(hispanic_representation = hispanic,
         hispanic_representation_quality = hispanic_quality) 

note_ul_bound <- 'Lower/Upper bound'

```

# `r upward_county`

```{r functions}


quality_value_mapping <- function(input){
  if (input == '1.00') {
    return ('Good')
  } else if (input == '2.00'){
    return ('Marginal')
  } else if (input == '3.00'){
    return ('Poor')
  } else 
    stop("Wrong input for Quality")
}


create_tb <- function(metrics_info_df, dataset, varname_maps){
  
  mb_metrics <- metrics_info_df[3]
  mb_vars  <- metrics_info_df[4][[1]]
  quality_var  <- metrics_info_df[5][[1]]
  metrics_desp  <- metrics_info_df[7]
  data_source <- metrics_info_df[8]
  col_from <- varname_maps[1][[1]]
  col_to <- varname_maps[2][[1]]

  temp <- dataset %>% 
      select(matches(glue('{mb_vars}|{quality_var}|state_county'))) %>% 
      select(-matches('_lb|_ub')) %>% 
      select(sort(tidyselect::peek_vars())) %>% 
      rename_at(vars(all_of(col_from)), function(x) col_to) 

  if (str_detect(quality_var, '|') == FALSE){ #each variable has its own quality variable  
    
    temp <- temp %>% 
       relocate(!!sym(quality_var), .after = last_col())  
    
  } 
  
  temp %>% 
    pivot_longer(!state_county, names_to='metrics', values_to='value') %>%   
    pivot_wider(names_from = 'state_county', values_from = 'value') %>% 
    arrange(match(metrics, col_to)) %>% 
    mutate(metrics = gsub('.*_quality', 'Quality', metrics)) %>% 
    select(metrics, everything()) %>% 
    gt(rowname_col = 'metrics') %>% 
    tab_header(
      title = html(glue('<p style="font-weight: bold;">{mb_metrics}</p>')), 
      subtitle = metrics_desp
    ) %>% 
    tab_source_note(str_c('Source:', data_source, sep=' ')) %>% 
    cols_align(
      align = 'left',
      columns = TRUE
    ) %>% 
    cols_align(
      align = 'left',
      columns = TRUE
    ) %>% 
    opt_align_table_header('left') %>% 
    tab_options(
      heading.title.font.size = tb_title_size, 
      heading.subtitle.font.size = tb_subtitle_size, 
      column_labels.font.size = tb_font_size,
      table.font.size = tb_font_size,
      source_notes.font.size = source_note_size, 
      table.width = pct(tb_width_perc), 
      table.align = tb_align)
}


unite_col_values <- function(df, colname_str){
  
  df <- df %>% 
    unite(!!sym(glue('{colname_str}_ci')), 
          glue('{colname_str}_lb'), 
          glue('{colname_str}_ub'), 
          sep = ', ', 
          remove=TRUE,
          na.rm = TRUE) %>% 
    
    mutate_at(vars(matches(glue('{colname_str}_ci'))), function(x) glue('({x})'))
  
  return(df)
}


create_tb_level2 <- function(metrics_info_df, dataset, varname_maps){
  
  mb_metrics <- metrics_info_df[3]
  mb_vars  <- metrics_info_df[4][[1]]
  quality_var  <- metrics_info_df[5][[1]]
  metrics_desp  <- metrics_info_df[7]
  data_source <- metrics_info_df[8]
  ci_vars <- metrics_info_df[6]
  notes <- metrics_info_df[9]
  col_from <- varname_maps[3][[1]]
  col_to <- varname_maps[4][[1]]
  
  mb_vars_lst <- colnames(dataset %>% select(setdiff(matches(mb_vars), matches('_lb|_ub|_quality'))))
  

  if (ci_vars == 1){
    
    for (val in mb_vars_lst){      # update this to purrr 
      dataset <- unite_col_values(dataset, val)
    }
    
    ci_str <- 'Confidence Interval'
    
  } else if (ci_vars == 2){
    
    ci_str <- 'Confidence Interval*'   # *CI not available at this time.
    
    # create an empty df      #take this part out as a sep func 
    col_names <- glue('{mb_vars_lst}_ci')
    vec <- vector(mode = 'character', length = nrow(dataset) * length(mb_vars_lst))
    empty_ci_df <- as.data.frame(matrix(vec, c(nrow(dataset), length(mb_vars_lst))))
    colnames(empty_ci_df)[1:length(mb_vars_lst)] <- col_names
    
    # bind df with '*_ci' columns with original df 
    dataset <- dataset %>% bind_cols(empty_ci_df)
    
  } else if (ci_vars == 3){

    ci_str <- 'Confidence Interval+'   # '+CI not applicable.
    
    # create an empty df 
    col_names <- glue('{mb_vars_lst}_ci')
    vec <- vector(mode = 'character', length = nrow(dataset) * length(mb_vars_lst))
    empty_ci_df <- as.data.frame(matrix(vec, c(nrow(dataset), length(mb_vars_lst))))
    colnames(empty_ci_df)[1:length(mb_vars_lst)] <- col_names
    
    # bind df with '*_ci' columns with original df 
    dataset <- dataset %>% bind_cols(empty_ci_df)
  }
  
  temp <- dataset %>% 
    select(matches(glue('{mb_vars}|{quality_var}|state_county')), -matches('_lb|ub')) %>% 
    mutate_all(as.character) %>% 
    rename_at(vars(col_from), function(x) col_to)
    
  if (str_detect(quality_var, '|') == FALSE){ #each variable has its own quality variable  
    
    temp <- temp %>% 
       relocate(!!sym(quality_var), .after = last_col())  
    
  } 
  
  temp %>% 
    pivot_longer(!state_county, names_to='metrics', values_to='value') %>%
    pivot_wider(names_from = 'state_county', values_from = 'value') %>% 
    arrange(match(metrics, col_to)) %>% 
    mutate(metrics = gsub('.*ci', ci_str, metrics)) %>% 
    mutate(metrics = gsub('.*_quality', 'Quality', metrics)) %>% 
    select(metrics, everything()) %>% 
    gt(rowname_col = 'metrics') %>% 
    tab_header(
      title = html(glue('<p style="font-weight: bold;">{mb_metrics}</p>')), 
      subtitle = metrics_desp
    ) %>% 
    tab_source_note(str_c('Source:', data_source, sep=' ')) %>% 
    tab_source_note(str_c('Notes:', notes, sep=' ')) %>% 
    cols_align(
      align = 'left',
      columns = TRUE
    ) %>% 
    cols_align(
      align = 'left',
      columns = TRUE
    ) %>% 
    opt_align_table_header('left') %>% 
    tab_options(
      heading.title.font.size = tb_title_size, 
      heading.subtitle.font.size = tb_subtitle_size, 
      column_labels.font.size = tb_font_size,
      table.font.size = tb_font_size,
      source_notes.font.size = source_note_size, 
      table.width = pct(tb_width_perc), 
      table.align = tb_align) 
} 


get_vars_info <- function(varname, data_summary_file=m_info){
  
  info_lst <- data_summary_file %>% 
    filter(metric_name == varname) %>%
    purrr::transpose() %>% 
    simplify() %>%
    first()
  
  mb_vars <- info_lst[4][[1]]
  
  return(list(info_lst=info_lst, mb_vars=mb_vars))
}

```

## Driver:  Strong and Healthy Families

### Predictor: Financial well-being {.tabset}

#### Summary
```{r income}

income_varlist <- list(
  c(
    'pctl_20', 
    'pctl_50', 
    'pctl_80'
  ), 
  c(
    '20th Percentile', 
    '50th Percentile', 
    '80th Percentile'
  ), 
  c(
    'pctl_20', 
    'pctl_20_ci', 
    'pctl_50', 
    'pctl_50_ci', 
    'pctl_80',
    'pctl_80_ci'
  ), 
  c(
    '20th Percentile', 
    '20th Percentile ci', 
    '50th Percentile', 
    '50th Percentile ci', 
    '80th Percentile', 
    '80th Percentile ci'
  ) 
)


income_m_info_lst <- get_vars_info('Income')$info_lst
mb_vars <- get_vars_info('Income')$mb_vars

data_sub <- data %>% 
  mutate_at(vars(matches(mb_vars), -ends_with('_quality')), 
            function(x) gsub("\\..*","", glue('${x}')))

create_tb(income_m_info_lst, data_sub, income_varlist) 


debt_varlist <- list(
  c('share_debt_coll'),
  c('% with debt'), 
  c(
    'share_debt_coll', 
    'share_debt_coll_ci'
  ),
  c(
    '% with debt', 
    '% with debt ci')
)

m_info_lst <- get_vars_info('Financial Security')$info_lst
mb_vars <- get_vars_info('Financial Security')$mb_vars

create_tb(m_info_lst, data, debt_varlist) 

```

#### Detail

```{r income detailed}

create_tb_level2(income_m_info_lst, data_sub, income_varlist)

create_tb_level2(m_info_lst, data, debt_varlist)

```


### Predictor: Housing {.tabset}

#### Summary
```{r housing summary}

housing_varlist <- list(
  c(
    'share_affordable_80_ami', 
    'share_affordable_50_ami'
  ), 
  c(
    'Ratio for low-income households', 
    'Ratio for very low-income households' 
  ), 
  c(
    'share_affordable_80_ami', 
    'share_affordable_80_ami_ci', 
    'share_affordable_50_ami',
    'share_affordable_50_ami_ci'
  ), 
  c('Ratio for low-income households', 
    'Ratio for low-income households ci', 
    'Ratio for very low-income households', 
    'Ratio for very low-income households ci' 
  )
)

af_m_info_lst <- get_vars_info('Affordable housing')$info_lst

create_tb(af_m_info_lst, data, housing_varlist) 

```



```{r}

housing_insta_varlist <- list(
  c(
    'homeless_count', 
    'homeless_share'
  ), 
  c(
    'Number homeless',
    'Share homeless'
  ),
  c(
    'homeless_count', 
    'homeless_count_ci', 
    'homeless_share',
    'homeless_share_ci'
  ), 
  c(
    'Number homeless',
    note_ul_bound, 
    'Share homeless',
    'Share homeless ci'
  )
)

m_info_lst <- get_vars_info('Housing instablity and homelessness')$info_lst

create_tb(m_info_lst, data, housing_insta_varlist) 


```


#### Detail

```{r housing detailed}

create_tb_level2(af_m_info_lst, data, housing_varlist)

create_tb_level2(m_info_lst, data, housing_insta_varlist) 

```


### Predictor: Family {.tabset}

#### Summary

```{r family summary}

famstruc_varlist <- list(
  c(
    'famstruc_2par_married', 
    'famstruc_2par_unmarried', 
    'famstruc_1par_plusadults', 
    'famstruc_1par_noadults',
    'famstruc_0par_2adults',	
    'famstruc_0par_other'
  ), 
  c(
    'Two married biological/adoptive parents', 
    'One biological/adoptive parent and that parents current spouse/partner', 
    'One biological/adoptive parent and at least one other adult', 
    'One biological/adoptive parent',
    'Zero biological/adoptive parents, but at least two adults',
    'Other'
  ), 
  c(
    'famstruc_2par_married', 
    'famstruc_2par_married_ci',
    'famstruc_2par_unmarried', 
    'famstruc_2par_unmarried_ci',
    'famstruc_1par_plusadults', 
    'famstruc_1par_plusadults_ci', 
    'famstruc_1par_noadults',
    'famstruc_1par_noadults_ci',
    'famstruc_0par_2adults',	
    'famstruc_0par_2adults_ci',	
    'famstruc_0par_other',
    'famstruc_0par_other_ci'
  ), 
  c(
    'Two married biological/adoptive parents', 
    'Two married biological/adoptive parents ci', 
    'One biological/adoptive parent and that parents current spouse/partner', 
    'One biological/adoptive parent and that parents current spouse/partner ci', 
    'One biological/adoptive parent and at least one other adult', 
    'One biological/adoptive parent and at least one other adult ci', 
    'One biological/adoptive parent',
    'One biological/adoptive parent ci',
    'Zero biological/adoptive parents, but at least two adults',
    'Zero biological/adoptive parents, but at least two adults ci',
    'Other', 
    'Other ci'
  ) 
)

fss_m_info_lst <- get_vars_info('Family structure and stability')$info_lst

create_tb(fss_m_info_lst, data, famstruc_varlist) 

```

#### Detail

```{r family detailed}

create_tb_level2(fss_m_info_lst, data, famstruc_varlist)

```


### Predictor: Health {.tabset}

#### Summary 

```{r Access to and utilization of health services}

accuils_varlist <- list(
  c(
    'hpsa_yn'
  ), 
  c(
    'Ranking (0-25, higher = greater shortage)'
  ), 
  c(
    'hpsa_yn',
    'hpsa_yn_ci'
  ), 
  c(
    'Ranking (0-25, higher = greater shortage)',
    'Ranking (0-25, higher = greater shortage) ci'
  )
)

m_info_lst <- get_vars_info('Access to and utilization of health services')$info_lst

create_tb(m_info_lst, data, accuils_varlist) 



neonatal_varlist <- list(
  c('lbw'),
  c('% low-weight birth'),
  c(
    'lbw', 
    'lbw_ci'
  ),
  c(
    '% low-weight birth', 
    note_ul_bound)
)

nh_m_info_lst <- get_vars_info('Neonatal Health')$info_lst

create_tb(nh_m_info_lst, data, neonatal_varlist) 


```


#### Detail

```{r}

create_tb_level2(m_info_lst, data, accuils_varlist) 

create_tb_level2(nh_m_info_lst, data, neonatal_varlist) 

```


## Driver: Supportive Communities

### Predictor: Local Governance {.tabset}

#### Summary 

```{r election_turnout}

election_turnout_varlist <- list(
  c('election_turnout'),
  c('% voting'),
  c(
    'election_turnout', 
    'election_turnout_ci'
  ),
  c(
    '% voting', 
    '% voting ci')
)

et_m_info_lst <- get_vars_info('Political Participation')$info_lst

create_tb(et_m_info_lst, data, election_turnout_varlist) 



desp_rep_varlist <- list(
  c('white_nonhispanic',
    'white_nonhispanic_quality',
    'black_nonhispanic',
    'black_nonhispanic_quality', 
    'hispanic_representation',
    'hispanic_representation_quality',
    'asian_other',
    'asian_other_quality'),
  c('Non-Black, Non-Hispanic', 
    'Non-Black, Non-Hispanic_quality', 
    'Black, Non-Hispanic', 
    'Black, Non-Hispanic_quality', 
    'hispanic_representation', 
    'hispanic_representation_quality',
    'Asian',
    'Asian_quality'
  ),
  c(
    'white_nonhispanic', 
    'white_nonhispanic_ci',
    'white_nonhispanic_quality',
    'black_nonhispanic',
    'black_nonhispanic_ci',
    'black_nonhispanic_quality', 
    'hispanic_representation', 
    'hispanic_representation_ci',
    'hispanic_representation_quality',
    'asian_other', 
    'asian_other_ci',
    'asian_other_quality'
  ),
  c('Non-Black, Non-Hispanic', 
    'Non-Black, Non-Hispanic ci', 
    'Non-Black, Non-Hispanic_quality',
    'Black, Non-Hispanic', 
    'Black, Non-Hispanic ci', 
    'Black, Non-Hispanic_quality', 
    'hispanic ', 
    'hispanic ci', 
    'hispanic_quality',
    'Asian',
    'Asian ci',
    'Asian_quality'
  )
)

m_info_lst <- get_vars_info('Descriptive representation among local officials')$info_lst

create_tb(m_info_lst, data, desp_rep_varlist) 


```

#### Detail

```{r ele detailed}

create_tb_level2(et_m_info_lst, data, election_turnout_varlist) 

create_tb_level2(m_info_lst, data, desp_rep_varlist) 

```



### Predictor: Neighborhoods {.tabset}

#### Summary 

```{r Economic Inclusion}

econ_inc_varlist <- list(
  c('poverty_exposure'),
  c('% in high poverty neigborhoods'),
  c(
    'poverty_exposure', 
    'poverty_exposure_ci'
  ),
  c(
    '% in high poverty neigborhoods', 
    '% in high poverty neigborhoods ci')
)

ei_m_info_lst <- get_vars_info('Economic Inclusion')$info_lst

create_tb(ei_m_info_lst, data, econ_inc_varlist) 



race_div <- list(
  c('white_nh_exposure',
    'white_nh_exposure_quality', 
    'black_nh_exposure',
    'black_nh_exposure_quality', 
    'hispanic_exposure',
    'hispanic_exposure_quality'),
  c('Non-Black, Non-Hispanic to all other', 
    'Non-Black, Non-Hispanic to all other_quality', 
    'Black, Non-Hispanic to all other', 
    'Black, Non-Hispanic to all other_quality', 
    'Hispanic to all other', 
    'Hispanic to all other_quality'
  ),
  c('white_nh_exposure',
    'white_nh_exposure_ci',
    'white_nh_exposure_quality', 
    'black_nh_exposure',
    'black_nh_exposure_ci',
    'black_nh_exposure_quality', 
    'hispanic_exposure',
    'hispanic_exposure_ci',
    'hispanic_exposure_quality'),
  c('Non-Black, Non-Hispanic to all other', 
    'Non-Black, Non-Hispanic to all other_ci', 
    'Non-Black, Non-Hispanic to all other_quality',
    'Black, Non-Hispanic to all other', 
    'Black, Non-Hispanic to all other_ci',
    'Black, Non-Hispanic to all other_quality', 
    'Hispanic to all other', 
    'Hispanic to all other_ci', 
    'Hispanic to all other_quality'
  )
)

rd_m_info_lst <- get_vars_info('Racial Diversity')$info_lst
create_tb(rd_m_info_lst, data, race_div) 


trans_access <- list(
  c('transit_trips'),
  c('Transit trips'),
  c(
    'transit_trips', 
    'transit_trips_ci'
  ),
  c(
    'Transit trips', 
    'Transit trips ci')
)


trans_info_lst <- get_vars_info('Transportation access')$info_lst

create_tb(trans_info_lst, data, trans_access) 



trans_cost_varlist <- list(
  c('transit_cost'),
  c('Transit cost'),
  c(
    'transit_cost', 
    'transit_cost_ci'
  ),
  c(
    'Transit cost', 
    'Transit cost ci')
)

tr_cost_m_info_lst <- get_vars_info('Transportation access-cost')$info_lst

create_tb(tr_cost_m_info_lst, data, trans_cost_varlist) 



env_varlist <- list(
  c('haz_idx'),
  c('AQI'),
  c(
    'haz_idx', 
    'haz_idx_ci'
  ),
  c(
    'AQI', 
    'AQI ci')
)

env_m_info_lst <- get_vars_info('Environmental Quality')$info_lst

create_tb(env_m_info_lst, data, env_varlist) 


```

#### Detail

```{r Economic Inclusion detailed}

create_tb_level2(ei_m_info_lst, data, econ_inc_varlist) 

create_tb_level2(rd_m_info_lst, data, race_div) 

create_tb_level2(trans_info_lst, data, trans_access) 

create_tb_level2(tr_cost_m_info_lst, data, trans_cost_varlist) 

create_tb_level2(env_m_info_lst, data, env_varlist) 

```


### Predictor: Safety {.tabset}


#### Summary 

```{r Exposure to crime}

exp_crime_varlist <- list(
  c(
    'violent_crime_rate',
    'property_crime_rate'
  ),
  c(
    'Violent crime', 
    'Property crime'
  ),
  c(
    'violent_crime_rate',
    'violent_crime_rate_ci', 
    'property_crime_rate',
    'property_crime_rate_ci'
  ),
  c(
    'Violent crime', 
    'Violent crime ci', 
    'Property crime', 
    'Property crime ci'
  )
)

ec_m_info_lst <- get_vars_info('Exposure to crime')$info_lst

create_tb(ec_m_info_lst, data, exp_crime_varlist) 


punative_policing <- list(
  c('juvenile_arrest_rate'),
  c('Juvenile arrests'),
  c(
    'juvenile_arrest_rate', 
    'juvenile_arrest_rate_ci'
  ),
  c(
    'Juvenile arrests', 
    'Juvenile arrests ci')
)


m_info_lst <- get_vars_info('Overly punative policing')$info_lst

create_tb(m_info_lst, data, punative_policing) 


```


#### Detail

```{r exp_crime_varlist d}

create_tb_level2(ec_m_info_lst, data, exp_crime_varlist) 

create_tb_level2(m_info_lst, data, punative_policing) 

```

## Driver: Earn and learn

### Predictor: Education	{.tabset}

#### Summary 

```{r share_in_preschool}

share_in_presch_varlist <- list(
  c('share_in_preschool'),
  c('% in pre-k'),
  c(
    'share_in_preschool', 
    'share_in_preschool_ci'
  ),
  c(
    '% in pre-k', 
    '% in pre-k ci')
)

ap_m_info_lst <- get_vars_info('Access to Preschool')$info_lst

create_tb(ap_m_info_lst, data, share_in_presch_varlist) 


eff_pub_ed <- list(
  c('learning_rate'),
  c('change in ELA achievement'),
  c(
    'learning_rate', 
    'learning_rate_ci'
  ),
  c(
    'Change in ELA achievement', 
    note_ul_bound)
)


epd_m_info_lst <- get_vars_info('Effective public education')$info_lst
create_tb(epd_m_info_lst, data, eff_pub_ed) 


stu_poverty <- list(
  c('frpl40_white', 
    'frpl40_white_quality',
    'frpl40_black',
    'frpl40_black_quality',
    'frpl40_hispanic', 
    'frpl40_hispanic_quality'
    ),
  c(
    'White, non-Hispanic', 
    'White, non-Hispanic_quality',
    'Black, non-Hispanic', 
    'Black, non-Hispanic_quality', 
    'Hispanic', 
    'Hispanic_quality'
    ),
  c('frpl40_white', 
    'frpl40_white_ci', 
    'frpl40_white_quality',
    'frpl40_black',
    'frpl40_black_ci', 
    'frpl40_black_quality',
    'frpl40_hispanic', 
    'frpl40_hispanic_ci',
    'frpl40_hispanic_quality'
    ),
  c(
    'White, non-Hispanic', 
    'White, non-Hispanic_ci', 
    'White, non-Hispanic_quality',
    'Black, non-Hispanic', 
    'Black, non-Hispanic_ci',
    'Black, non-Hispanic_quality', 
    'Hispanic', 
    'Hispanic_ci',
    'Hispanic_quality'
    )
)


spoverty_m_info_lst <- get_vars_info('Student poverty concentration')$info_lst

create_tb(spoverty_m_info_lst, data, stu_poverty) 



college_readiness <- list(
  c('share_hs_degree'),
  c('% with HS degree'),
  c(
    'share_hs_degree', 
    'share_hs_degree_ci'
  ),
  c(
    '% with HS degree', 
    '% with HS degree ci')
)

m_info_lst <- get_vars_info('College readiness')$info_lst
create_tb(m_info_lst, data, college_readiness) 




```

#### Detail

```{r share_in_presch_varlist d}

create_tb_level2(ap_m_info_lst, data, share_in_presch_varlist) 

create_tb_level2(epd_m_info_lst, data, eff_pub_ed) 

create_tb_level2(spoverty_m_info_lst, data, stu_poverty) 

create_tb_level2(m_info_lst, data, college_readiness) 

```


### Predictor: Work {.tabset}

#### Summary 

```{r}

emp_lst <- list(
  c('share_employed'),
  c('Employment to population ratio'),
  c(
    'share_employed', 
    'share_employed_ci'
  ),
  c(
    'Employment to population ratio', 
    'Employment to population ratio ci')
)


emp_m_info_lst <- get_vars_info('Employment')$info_lst

create_tb(emp_m_info_lst, data, emp_lst) 



job_wage <- list(
  c('average_to_living_wage_ratio'),
  c('Ratio of pay to living wage'),
  c(
    'average_to_living_wage_ratio', 
    'average_to_living_wage_ratio_ci'
  ),
  c(
    'Ratio of pay to living wage', 
    'Ratio of pay to living wage ci')
)


m_info_lst <- get_vars_info('Access to jobs paying a living wage')$info_lst

create_tb(m_info_lst, data, job_wage) 


```


#### Detail

```{r}

create_tb_level2(emp_m_info_lst, data, emp_lst) 

create_tb_level2(m_info_lst, data, job_wage) 

```



## Notes on Data Quality
| 'Good' indicates that the metric is measured with adequate accuracy at sample size.
| 'Marginal' indicates that there are known shortcomings of the data for this metric for this county, and the metric should be used with caution.
| 'Poor' indicates that although the metric could be computed for this county, we have serious concerns about how accurately it is measured for this county and do not recommend its use.


## Additional Notes
| Metrics requiring orginal data collection: 
|    Overall health: Share of adults who rate their own and their children’s health as good or excellent
|    Belonginess: Inclusion of other in the self scale
|    Social Capital: Social capital community benchmark scale
|    Exposure to Trauma: Adverse childhood experiences scale
|
| *Confidence Interval: Confidence interval not available at this time
| +Confidence Interval: Confidence interval not applicable
| Lower/Upper bound:  The data used to construct this metric do not lend themselves to conventional confidence intervals. The value of the metric shown represents are best estimate; the lower and upper bounds represent alternative estimates of the metric under different assumptions about missing data.
